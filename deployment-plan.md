# 智能少年AI学习平台 - 部署方案

## 部署架构概览

针对中国大陆用户的特殊需求，推荐以下架构：

```
用户 → CDN（阿里云/腾讯云） → 前端应用（Vercel/阿里云OSS）
                    ↓
                API网关
                    ↓
        ├── 后端服务（阿里云ECS/函数计算）
        ├── 数据库（阿里云RDS PostgreSQL）
        ├── 文件存储（阿里云OSS）
        └── AI服务（DeepSeek API）
```

## 一、技术选型建议

### 1. 前端托管
- **方案A（推荐）**: Vercel + 国内CDN
  - 优势：部署简单，自动CI/CD，全球节点
  - 需要：配置国内CDN加速

- **方案B**: 阿里云OSS + CDN
  - 优势：完全国内托管，访问速度快
  - 需要：手动配置CI/CD

### 2. 数据库
- **当前**: Supabase (PostgreSQL)
- **迁移到**:
  - 阿里云RDS PostgreSQL
  - 或继续使用Supabase + 国内节点代理

### 3. 文件存储
- **从**: Supabase Storage
- **迁移到**: 阿里云OSS
  - 支持大文件上传
  - 国内访问速度快
  - 成本可控

### 4. 后端服务
- **PDF解析服务**: 阿里云ECS或函数计算
- **API代理**: 阿里云API网关

## 二、部署前准备

### 1. 域名准备
- [ ] 购买域名（如：smartyouth.cn）
- [ ] 进行ICP备案（约15-20天）
- [ ] 申请SSL证书（免费或付费）

### 2. 阿里云账号准备
- [ ] 注册阿里云账号
- [ ] 完成实名认证
- [ ] 开通以下服务：
  - OSS对象存储
  - CDN
  - RDS（如需要）
  - ECS（如需要）

### 3. 环境变量整理
需要准备的密钥和配置：
- Supabase配置
- DeepSeek API密钥
- 阿里云OSS配置
- 数据库连接信息

## 三、具体实施步骤

### 第一阶段：阿里云OSS配置（文档存储）

1. **创建OSS Bucket**
   - 地域选择：华东1（杭州）或华北2（北京）
   - 存储类型：标准存储
   - 权限：私有

2. **配置跨域访问**
   - 允许的来源：你的域名
   - 允许的方法：GET, POST, PUT, DELETE
   - 允许的头：*

3. **创建RAM用户**
   - 分配OSS读写权限
   - 获取AccessKey ID和Secret

### 第二阶段：代码改造

1. **集成阿里云OSS SDK**
2. **修改文件上传逻辑**
3. **添加OSS直传功能**（提高上传速度）
4. **配置文件访问权限**

### 第三阶段：部署应用

1. **前端部署**
   - 构建生产版本
   - 上传到托管服务
   - 配置自定义域名

2. **后端部署**
   - PDF服务容器化
   - 部署到阿里云

3. **数据库迁移**（可选）
   - 导出Supabase数据
   - 导入到阿里云RDS

### 第四阶段：CDN配置

1. **配置CDN加速**
   - 源站：你的应用域名
   - 缓存规则配置
   - HTTPS配置

2. **优化策略**
   - 静态资源缓存
   - 动态内容加速
   - 防盗链配置

### 第五阶段：监控和优化

1. **配置监控**
   - 阿里云监控
   - 错误日志收集
   - 性能监控

2. **安全配置**
   - WAF防护
   - DDoS防护
   - 数据备份

## 四、成本预估（月）

| 服务 | 规格 | 预估费用 |
|------|------|---------|
| 阿里云OSS | 100GB存储 + 流量 | ~50元 |
| CDN | 100GB流量 | ~20元 |
| ECS | 2核4G（PDF服务） | ~100元 |
| RDS | 1核2G PostgreSQL | ~150元 |
| 域名 | .cn域名 | ~30元/年 |
| **总计** | | **~320元/月** |

注：可以先使用按量付费，根据实际使用情况调整

## 五、时间规划

- 第1-2天：阿里云服务开通和配置
- 第3-5天：代码改造和OSS集成
- 第6-7天：应用部署和测试
- 第8-10天：CDN配置和优化
- 第11-15天：ICP备案等待期
- 第16天：正式上线

## 六、备选方案

### 轻量级方案（推荐先试用）
1. 继续使用Supabase（配置国内代理）
2. 仅将文件存储迁移到阿里云OSS
3. 使用Vercel部署前端
4. 通过Cloudflare CDN加速

### 优势
- 改动最小
- 成本最低（~100元/月）
- 可快速上线

## 七、注意事项

1. **合规要求**
   - ICP备案必须完成
   - 用户协议和隐私政策
   - 未成年人保护措施

2. **数据安全**
   - 敏感数据加密
   - 定期备份
   - 访问控制

3. **性能优化**
   - 图片压缩和懒加载
   - 代码分割
   - API请求优化

## 下一步行动

1. 确认部署方案（轻量级 or 完整方案）
2. 注册并配置阿里云账号
3. 开始第一阶段：配置阿里云OSS

请告诉我你选择哪个方案，我会带你一步步完成具体的配置。